function updateGrid(){let e,t,r;for(r=0;r<4;r++)for(t=0;t<4;t++)e=gridElem.getElementsByTagName("div")[4*r+t],-1!==grid[r][t]?(e.innerHTML=grid[r][t],e.setAttribute("class","b"+grid[r][t])):(e.innerHTML="",e.setAttribute("class","bv"))}function moveGrid(e){let t,r,i=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];if(1===e)for(r=3;r>=0;r--)for(t=0;t<4;t++)0!=r&&grid[r][t]>0&&0===i[r][t]&&(grid[r-1][t]===grid[r][t]?(addScore(grid[r][t]),grid[r][t]=-1,grid[r-1][t]*=2,i[r-1][t]=1):-1===grid[r-1][t]&&(grid[r-1][t]=grid[r][t],grid[r][t]=-1));else if(2===e)for(t=0;t<4;t++)for(r=0;r<4;r++)3!=t&&grid[r][t]>0&&0===i[r][t]&&(grid[r][t+1]===grid[r][t]?(addScore(grid[r][t]),grid[r][t]=-1,grid[r][t+1]*=2,i[r][t+1]=1):-1===grid[r][t+1]&&(grid[r][t+1]=grid[r][t],grid[r][t]=-1));else if(3===e)for(t=3;t>=0;t--)for(r=3;r>=0;r--)0!=t&&grid[r][t]>0&&0===i[r][t]&&(grid[r][t-1]===grid[r][t]?(addScore(grid[r][t]),grid[r][t]=-1,grid[r][t-1]*=2,i[r][t-1]=1):-1===grid[r][t-1]&&(grid[r][t-1]=grid[r][t],grid[r][t]=-1));else if(4===e)for(r=0;r<4;r++)for(t=3;t>=0;t--)3!=r&&grid[r][t]>0&&0===i[r][t]&&(grid[r+1][t]===grid[r][t]?(addScore(grid[r][t]),grid[r][t]=-1,grid[r+1][t]*=2,i[r+1][t]=1):-1===grid[r+1][t]&&(grid[r+1][t]=grid[r][t],grid[r][t]=-1));spawnRand(),updateGrid(),getScore()}function calcScore(e){return 2===e?2:4===e?5:8===e?10:16===e?25:32===e?50:64===e?125:128===e?250:256===e?500:512===e?1e3:1024===e?2e3:2048===e?4e3:4096===e?8e3:8192===e?16e3:16384===e?32500:0}function addScore(e){score+=calcScore(e)}function getScore(){let e,t;for(sum=0,t=0;t<4;t++)for(e=0;e<4;e++)-1!==grid[t][e]&&(sum+=grid[t][e]);updateScore()}function updateScore(){shareElem.href=`https://twitter.com/home?status=Got%20a%20score%20of%20${score+sum}%20on%20%232048%20saming.fr/p/2048`,scoreElem.innerHTML=score+sum+"pts",updateBest(),updateLevel()}function getLevelText(e){return 1===e?"Welcome newbie":2===e?"Now you're playing":3===e?"Keep calm and press up":4===e?"That's okay for a first time I guess":5===e?"That's okay for a second time I guess":6===e?"This is getting serious isn't it":7===e?"Wow!":8===e?"Can I have an autograph?":9===e?"You're not supposed to see this, stop":10===e?"I'm pretty sure it's illegal to use supercomputers for that":""}function updateLevel(){level=Math.floor(Math.log(score+sum)/Math.log(4)),level>10&&(level=10),level<0&&(level=0);let e=getLevelText(level);levelText.innerHTML=`Level ${level} ${""===e?"":" â€” "+e}`,levelBar.style.width=`${10*level}%`}function getBest(){best=localStorage.getItem("2048best")}function setBest(e){localStorage.setItem("2048best",e),best=e}function updateBest(){best<score+sum&&setBest(score+sum),bestElem.innerHTML=`${best} pts`}function gameOver(){gridElem.setAttribute("class","over")}function keyPress(e){37===e||74===e?moveGrid(3):38===e||73===e?moveGrid(1):39===e||76===e?moveGrid(2):40===e||75===e?moveGrid(4):13===e&&init()}function spawnRand(){let e,t,r=[];for(t=0;t<4;t++)for(e=0;e<4;e++)-1===grid[t][e]&&r.push([e,t]);if(r.length){let e=8===Math.floor(9*Math.random())?4:2,t=r[Math.floor(Math.random()*r.length)],i=t[0],o=t[1];grid[o][i]=e}else checkMovable()||gameOver()}function checkMovable(){for(let e=0;e<4;e++)for(let t=0;t<4;t++)if(void 0!==grid[e+1]&&grid[e+1][t]===grid[e][t]||void 0!==grid[e][t+1]&&grid[e][t+1]===grid[e][t])return!0;return!1}function initScore(){score=0,sum=0,updateScore()}function initBest(){void 0===localStorage.getItem("2048best")&&setBest(0),getBest()}function initGrid(){grid=[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],spawnRand(),spawnRand(),updateGrid()}function init(){gridElem.removeAttribute("class"),initScore(),initBest(),initGrid()}let grid,gridElem=document.getElementById("grid"),touchElem=document.getElementById("touch"),score=0,sum=0,scoreElem=document.getElementById("score"),infoText=document.getElementById("text"),level=0,levelText=infoText.getElementsByTagName("p")[0],levelBar=document.getElementById("bar").getElementsByTagName("div")[0],best=0,bestElem=infoText.getElementsByTagName("p")[1],shareElem=document.getElementById("share");document.onkeydown=function(e){keyPress(e.keyCode)},document.getElementsByTagName("header")[0].getElementsByTagName("a")[0].onclick=init,touchElem.getElementsByTagName("div")[0].onclick=function(){moveGrid(1)},touchElem.getElementsByTagName("div")[1].onclick=function(){moveGrid(3)},touchElem.getElementsByTagName("div")[2].onclick=function(){moveGrid(2)},touchElem.getElementsByTagName("div")[3].onclick=function(){moveGrid(4)},initGrid(),initBest();